<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeciApp Statistics API Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .auth-section {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .auth-section h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .form-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            min-width: 200px;
        }

        .form-group input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .endpoints-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .endpoint-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #3498db;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .endpoint-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .endpoint-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .endpoint-card p {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .date-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .date-inputs input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .response-section {
            background: #2c3e50;
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .response-section h3 {
            margin-bottom: 15px;
            color: #ecf0f1;
        }

        .response-content {
            background: #34495e;
            padding: 20px;
            border-radius: 10px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .stat-card.revenue {
            background: linear-gradient(135deg, #27ae60, #229954);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #f39c12, #d68910);
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }

        .stat-card.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .transactions-list {
            background: #ecf0f1;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .transaction-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .transaction-item:last-child {
            margin-bottom: 0;
        }

        .transaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .transaction-amount {
            font-size: 1.3rem;
            font-weight: bold;
            color: #27ae60;
        }

        .transaction-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .transaction-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 0.85rem;
            color: #7f8c8d;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
        }

        .detail-label {
            font-weight: 600;
        }

        .json-toggle {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .json-toggle:hover {
            background: #7f8c8d;
        }

        .json-raw {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            margin-top: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
            display: none;
        }

        .error-message {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .success-message {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-success {
            background: #27ae60;
            color: white;
        }

        .status-error {
            background: #e74c3c;
            color: white;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .token-display {
            background: #ecf0f1;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: monospace;
            word-break: break-all;
            font-size: 12px;
            color: #2c3e50;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .endpoints-grid {
                grid-template-columns: 1fr;
            }
            
            .form-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 VeciApp Statistics API Tester</h1>
            <p>Herramienta completa para probar todos los endpoints de estadísticas</p>
        </div>

        <!-- Sección de Autenticación -->
        <div class="auth-section">
            <h3>🔐 Autenticación</h3>
            <div class="form-group">
                <input type="email" id="email" placeholder="Email" value="contact.alaskatech@gmail.com">
                <input type="password" id="password" placeholder="Password" value="Miclave.1">
                <button class="btn btn-primary" onclick="login()">Login</button>
            </div>
            <div id="tokenDisplay" class="token-display" style="display: none;"></div>
        </div>

        <!-- Configuración Global -->
        <div class="auth-section" style="background: linear-gradient(135deg, #8e44ad, #9b59b6);">
            <h3>⚙️ Configuración</h3>
            <div class="form-group">
                <input type="text" id="baseUrl" placeholder="Base URL" value="https://veciapp-backend.onrender.com/api/v1">
                <input type="text" id="vendorId" placeholder="Vendor ID" value="08f6ec09-0db8-4e7a-a0f3-209f16f4ee20">
            </div>
        </div>

        <!-- Grid de Endpoints -->
        <div class="endpoints-grid">
            <!-- Estadísticas de Clientes -->
            <div class="endpoint-card">
                <h4>👥 Estadísticas de Clientes</h4>
                <p>Obtiene estadísticas generales sobre los clientes registrados en la plataforma.</p>
                <div class="date-inputs">
                    <input type="date" id="customers-start" value="2024-01-01">
                    <input type="date" id="customers-end" value="2024-12-31">
                </div>
                <button class="btn btn-secondary" onclick="getCustomerStats()">Obtener Estadísticas</button>
            </div>

            <!-- Estadísticas de Vendedores -->
            <div class="endpoint-card">
                <h4>🏪 Estadísticas de Vendedores</h4>
                <p>Proporciona estadísticas relacionadas con los vendedores de la plataforma.</p>
                <div class="date-inputs">
                    <input type="date" id="vendors-start" value="2024-01-01">
                    <input type="date" id="vendors-end" value="2024-12-31">
                </div>
                <button class="btn btn-secondary" onclick="getVendorStats()">Obtener Estadísticas</button>
            </div>

            <!-- Estadísticas de Sucursales -->
            <div class="endpoint-card">
                <h4>🏢 Estadísticas de Sucursales</h4>
                <p>Devuelve estadísticas completas de las sucursales activas e inactivas.</p>
                <div class="date-inputs">
                    <input type="date" id="branches-start" value="2024-01-01">
                    <input type="date" id="branches-end" value="2024-12-31">
                </div>
                <button class="btn btn-secondary" onclick="getBranchStats()">Obtener Estadísticas</button>
            </div>

            <!-- Estadísticas de Pedidos -->
            <div class="endpoint-card">
                <h4>📦 Estadísticas de Pedidos</h4>
                <p>Recopila estadísticas detalladas sobre los pedidos y ingresos generados.</p>
                <div class="date-inputs">
                    <input type="date" id="orders-start" value="2024-01-01">
                    <input type="date" id="orders-end" value="2024-12-31">
                </div>
                <button class="btn btn-secondary" onclick="getOrderStats()">Obtener Estadísticas</button>
            </div>

            <!-- Estadísticas de Entregas -->
            <div class="endpoint-card">
                <h4>🚚 Estadísticas de Entregas</h4>
                <p>Ofrece estadísticas sobre las entregas y tiempos promedio de delivery.</p>
                <div class="date-inputs">
                    <input type="date" id="delivery-start" value="2024-01-01">
                    <input type="date" id="delivery-end" value="2024-12-31">
                </div>
                <button class="btn btn-secondary" onclick="getDeliveryStats()">Obtener Estadísticas</button>
            </div>

            <!-- Dashboard de Vendedor -->
            <div class="endpoint-card">
                <h4>📊 Dashboard de Vendedor</h4>
                <p>Obtiene estadísticas clave para el panel de un vendedor específico.</p>
                <button class="btn btn-secondary" onclick="getVendorDashboard()">Ver Dashboard</button>
            </div>

            <!-- Estadísticas de Notificaciones -->
            <div class="endpoint-card">
                <h4>📧 Historial de Notificaciones</h4>
                <p>Estadísticas sobre el historial de notificaciones enviadas.</p>
                <div class="date-inputs">
                    <input type="date" id="notifications-start" value="2024-01-01">
                    <input type="date" id="notifications-end" value="2024-12-31">
                </div>
                <button class="btn btn-secondary" onclick="getNotificationStats()">Obtener Estadísticas</button>
            </div>

            <!-- Estadísticas Push Notifications -->
            <div class="endpoint-card">
                <h4>🔔 Push Notifications Stats</h4>
                <p>Estadísticas generales del servicio de notificaciones push (Admin).</p>
                <button class="btn btn-secondary" onclick="getPushNotificationStats()">Obtener Estadísticas</button>
            </div>
        </div>

        <!-- Sección de Respuestas -->
        <div class="response-section">
            <h3 id="responseTitle">📋 Respuestas de la API</h3>
            <div id="responseContent" class="response-content">
                Selecciona un endpoint para ver las respuestas aquí...
            </div>
        </div>
    </div>

    <script>
        let authToken = '';
        
        // Variables globales
        const getBaseUrl = () => document.getElementById('baseUrl').value;
        const getVendorId = () => document.getElementById('vendorId').value;

        // Función de login
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            showLoading('Autenticando...');
            
            try {
                const response = await fetch(`${getBaseUrl()}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.data.token) {
                    authToken = `Bearer ${data.data.token}`;
                    showResponse('✅ Login exitoso', data, 'success');
                    
                    // Mostrar token
                    const tokenDisplay = document.getElementById('tokenDisplay');
                    tokenDisplay.style.display = 'block';
                    tokenDisplay.textContent = `Token: ${authToken}`;
                } else {
                    showResponse('❌ Error en login', data, 'error');
                }
            } catch (error) {
                showResponse('❌ Error de conexión', { error: error.message }, 'error');
            }
        }

        // Función genérica para hacer requests
        async function makeRequest(url, title) {
            if (!authToken) {
                showResponse('❌ Error', { error: 'Debes autenticarte primero' }, 'error');
                return;
            }
            
            showLoading(`Obteniendo ${title}...`);
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResponse(`✅ ${title}`, data, 'success');
                } else {
                    showResponse(`❌ Error obteniendo ${title}`, data, 'error');
                }
            } catch (error) {
                showResponse(`❌ Error de conexión para ${title}`, { error: error.message }, 'error');
            }
        }

        // Funciones específicas para cada endpoint
        async function getCustomerStats() {
            const startDate = document.getElementById('customers-start').value;
            const endDate = document.getElementById('customers-end').value;
            const url = `${getBaseUrl()}/customers/stats?startDate=${startDate}&endDate=${endDate}`;
            await makeRequest(url, 'Estadísticas de Clientes');
        }

        async function getVendorStats() {
            const startDate = document.getElementById('vendors-start').value;
            const endDate = document.getElementById('vendors-end').value;
            const url = `${getBaseUrl()}/vendors/stats?startDate=${startDate}&endDate=${endDate}`;
            await makeRequest(url, 'Estadísticas de Vendedores');
        }

        async function getBranchStats() {
            const startDate = document.getElementById('branches-start').value;
            const endDate = document.getElementById('branches-end').value;
            const url = `${getBaseUrl()}/branches/stats?startDate=${startDate}&endDate=${endDate}`;
            await makeRequest(url, 'Estadísticas de Sucursales');
        }

        async function getOrderStats() {
            const startDate = document.getElementById('orders-start').value;
            const endDate = document.getElementById('orders-end').value;
            const url = `${getBaseUrl()}/orders/stats?startDate=${startDate}&endDate=${endDate}`;
            await makeRequest(url, 'Estadísticas de Pedidos');
        }

        async function getDeliveryStats() {
            const startDate = document.getElementById('delivery-start').value;
            const endDate = document.getElementById('delivery-end').value;
            const url = `${getBaseUrl()}/delivery/stats?startDate=${startDate}&endDate=${endDate}`;
            await makeRequest(url, 'Estadísticas de Entregas');
        }

        async function getVendorDashboard() {
            const vendorId = getVendorId();
            const url = `${getBaseUrl()}/payments/dashboard/vendor/${vendorId}`;
            await makeRequest(url, 'Dashboard de Vendedor');
        }

        async function getNotificationStats() {
            const startDate = document.getElementById('notifications-start').value;
            const endDate = document.getElementById('notifications-end').value;
            const url = `${getBaseUrl()}/notification-history/stats?startDate=${startDate}&endDate=${endDate}`;
            await makeRequest(url, 'Estadísticas de Notificaciones');
        }

        async function getPushNotificationStats() {
            const url = `${getBaseUrl()}/push-notifications/admin/stats`;
            await makeRequest(url, 'Estadísticas Push Notifications');
        }

        // Funciones de UI
        function showLoading(message) {
            const responseTitle = document.getElementById('responseTitle');
            const responseContent = document.getElementById('responseContent');
            
            responseTitle.innerHTML = `<span class="loading"></span> ${message}`;
            responseContent.innerHTML = '<div style="text-align: center; padding: 40px; color: #7f8c8d;">Procesando solicitud...</div>';
        }

        function showResponse(title, data, status) {
            const responseTitle = document.getElementById('responseTitle');
            const responseContent = document.getElementById('responseContent');
            
            const statusClass = status === 'success' ? 'status-success' : 'status-error';
            responseTitle.innerHTML = `${title} <span class="status-indicator ${statusClass}">${status.toUpperCase()}</span>`;
            
            if (status === 'error') {
                responseContent.innerHTML = formatErrorResponse(data);
            } else {
                responseContent.innerHTML = formatResponse(data, title);
            }
        }

        // Formatear respuestas de error
        function formatErrorResponse(data) {
            return `
                <div class="error-message">
                    <h4>❌ Error en la solicitud</h4>
                    <p>${data.error || data.message || 'Error desconocido'}</p>
                </div>
                <button class="json-toggle" onclick="toggleJson(this)">Ver JSON completo</button>
                <div class="json-raw">${JSON.stringify(data, null, 2)}</div>
            `;
        }

        // Formatear respuestas exitosas
        function formatResponse(data, title) {
            if (!data.data) {
                return `
                    <div class="error-message">
                        <h4>⚠️ Respuesta inesperada</h4>
                        <p>La respuesta no tiene el formato esperado</p>
                    </div>
                    <button class="json-toggle" onclick="toggleJson(this)">Ver JSON completo</button>
                    <div class="json-raw">${JSON.stringify(data, null, 2)}</div>
                `;
            }

            const responseData = data.data;

            // Determinar el tipo de respuesta y formatear apropiadamente
            if (title.includes('Dashboard de Vendedor')) {
                return formatVendorDashboard(responseData);
            } else if (title.includes('Estadísticas')) {
                return formatStatistics(responseData, title);
            } else {
                return formatGenericResponse(responseData);
            }
        }

        // Formatear dashboard de vendedor
        function formatVendorDashboard(data) {
            const summary = data.summary || {};
            const transactions = data.recentTransactions || [];

            let html = '<div class="success-message">✅ Dashboard cargado exitosamente</div>';

            // Resumen financiero
            html += '<h4 style="margin-bottom: 15px; color: #2c3e50;">💰 Resumen Financiero</h4>';
            html += '<div class="stats-grid">';
            html += `<div class="stat-card revenue">
                        <div class="stat-value">${formatCurrency(summary.totalSales || 0)}</div>
                        <div class="stat-label">Ventas Totales</div>
                     </div>`;
            html += `<div class="stat-card">
                        <div class="stat-value">${summary.totalTransactions || 0}</div>
                        <div class="stat-label">Transacciones</div>
                     </div>`;
            html += `<div class="stat-card">
                        <div class="stat-value">${formatCurrency(summary.salesToday || 0)}</div>
                        <div class="stat-label">Ventas Hoy</div>
                     </div>`;
            html += `<div class="stat-card">
                        <div class="stat-value">${formatCurrency(summary.salesLast7Days || 0)}</div>
                        <div class="stat-label">Últimos 7 días</div>
                     </div>`;
            html += '</div>';

            // Transacciones recientes
            if (transactions.length > 0) {
                html += '<h4 style="margin: 25px 0 15px 0; color: #2c3e50;">📋 Transacciones Recientes</h4>';
                html += '<div class="transactions-list">';
                
                transactions.forEach(transaction => {
                    html += `
                        <div class="transaction-item">
                            <div class="transaction-header">
                                <span class="transaction-amount">${formatCurrency(transaction.amount || 0)}</span>
                                <span class="transaction-status status-${transaction.state || 'pending'}">${transaction.state || 'Pendiente'}</span>
                            </div>
                            <div class="transaction-details">
                                <div class="detail-item">
                                    <span class="detail-label">ID:</span>
                                    <span>${transaction.id?.substring(0, 8) || 'N/A'}...</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Proveedor:</span>
                                    <span>${transaction.provider || 'N/A'}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Tipo:</span>
                                    <span>${transaction.type || 'N/A'}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Fecha:</span>
                                    <span>${formatDate(transaction.createdAt) || 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            }

            html += '<button class="json-toggle" onclick="toggleJson(this)">Ver JSON completo</button>';
            html += `<div class="json-raw">${JSON.stringify(data, null, 2)}</div>`;

            return html;
        }

        // Formatear estadísticas generales
        function formatStatistics(data, title) {
            let html = '<div class="success-message">✅ Estadísticas obtenidas exitosamente</div>';

            html += `<h4 style="margin-bottom: 15px; color: #2c3e50;">${getStatsIcon(title)} ${title.replace('Estadísticas de ', '')}</h4>`;
            html += '<div class="stats-grid">';

            // Mapear campos comunes
            const fieldMappings = {
                total_customers: { label: 'Total Clientes', type: 'default' },
                new_customers_period: { label: 'Nuevos Clientes', type: 'default' },
                active_customers: { label: 'Clientes Activos', type: 'default' },
                inactive_customers: { label: 'Clientes Inactivos', type: 'warning' },
                total_vendors: { label: 'Total Vendedores', type: 'default' },
                new_vendors_period: { label: 'Nuevos Vendedores', type: 'default' },
                approved_vendors: { label: 'Vendedores Aprobados', type: 'default' },
                pending_vendors: { label: 'Vendedores Pendientes', type: 'warning' },
                total_branches: { label: 'Total Sucursales', type: 'default' },
                new_branches_period: { label: 'Nuevas Sucursales', type: 'default' },
                active_branches: { label: 'Sucursales Activas', type: 'default' },
                inactive_branches: { label: 'Sucursales Inactivas', type: 'warning' },
                total_orders: { label: 'Total Pedidos', type: 'default' },
                completed_orders: { label: 'Pedidos Completados', type: 'default' },
                pending_orders: { label: 'Pedidos Pendientes', type: 'warning' },
                cancelled_orders: { label: 'Pedidos Cancelados', type: 'danger' },
                total_revenue: { label: 'Ingresos Totales', type: 'revenue' },
                total_deliveries: { label: 'Total Entregas', type: 'default' },
                completed_deliveries: { label: 'Entregas Completadas', type: 'default' },
                in_progress_deliveries: { label: 'Entregas en Proceso', type: 'warning' },
                average_delivery_time_minutes: { label: 'Tiempo Promedio (min)', type: 'default' },
                total_delivery_cost: { label: 'Costo Total Entregas', type: 'revenue' },
                total_notifications: { label: 'Total Notificaciones', type: 'default' },
                sent_notifications: { label: 'Enviadas', type: 'default' },
                failed_notifications: { label: 'Fallidas', type: 'danger' },
                delivered_notifications: { label: 'Entregadas', type: 'default' },
                notificationsSent: { label: 'Enviadas', type: 'default' },
                notificationsFailed: { label: 'Fallidas', type: 'danger' },
                successRate: { label: 'Tasa de Éxito (%)', type: 'default' }
            };

            Object.keys(data).forEach(key => {
                const mapping = fieldMappings[key];
                if (mapping) {
                    const value = data[key];
                    const formattedValue = key.includes('revenue') || key.includes('cost') 
                        ? `${formatCurrency(value)}` 
                        : formatNumber(value);
                    
                    html += `<div class="stat-card ${mapping.type}">
                                <div class="stat-value">${formattedValue}</div>
                                <div class="stat-label">${mapping.label}</div>
                             </div>`;
                }
            });

            html += '</div>';
            html += '<button class="json-toggle" onclick="toggleJson(this)">Ver JSON completo</button>';
            html += `<div class="json-raw">${JSON.stringify(data, null, 2)}</div>`;

            return html;
        }

        // Formatear respuesta genérica
        function formatGenericResponse(data) {
            let html = '<div class="success-message">✅ Datos obtenidos exitosamente</div>';
            html += '<div class="stats-grid">';
            
            Object.keys(data).forEach(key => {
                const value = data[key];
                html += `<div class="stat-card">
                            <div class="stat-value">${formatValue(value)}</div>
                            <div class="stat-label">${formatKey(key)}</div>
                         </div>`;
            });
            
            html += '</div>';
            html += '<button class="json-toggle" onclick="toggleJson(this)">Ver JSON completo</button>';
            html += `<div class="json-raw">${JSON.stringify(data, null, 2)}</div>`;

            return html;
        }

        // Funciones auxiliares de formateo
        function formatCurrency(value) {
            if (!value) return '0';
            return Number(value).toLocaleString('es-CO');
        }

        function formatNumber(value) {
            if (!value) return '0';
            return Number(value).toLocaleString('es-CO');
        }

        function formatValue(value) {
            if (typeof value === 'number') {
                return formatNumber(value);
            }
            if (typeof value === 'string' && !isNaN(Number(value))) {
                return formatNumber(value);
            }
            return value;
        }

        function formatKey(key) {
            return key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function formatDate(dateString) {
            if (!dateString) return null;
            try {
                return new Date(dateString).toLocaleDateString('es-CO', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch {
                return dateString;
            }
        }

        function getStatsIcon(title) {
            if (title.includes('Clientes')) return '👥';
            if (title.includes('Vendedores')) return '🏪';
            if (title.includes('Sucursales')) return '🏢';
            if (title.includes('Pedidos')) return '📦';
            if (title.includes('Entregas')) return '🚚';
            if (title.includes('Notificaciones')) return '📧';
            if (title.includes('Push')) return '🔔';
            return '📊';
        }

        function toggleJson(button) {
            const jsonDiv = button.nextElementSibling;
            if (jsonDiv.style.display === 'none' || !jsonDiv.style.display) {
                jsonDiv.style.display = 'block';
                button.textContent = 'Ocultar JSON';
            } else {
                jsonDiv.style.display = 'none';
                button.textContent = 'Ver JSON completo';
            }
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Establecer fechas por defecto
            const today = new Date().toISOString().split('T')[0];
            const startOfYear = '2024-01-01';
            
            // Si quieres usar fechas dinámicas, descomenta estas líneas:
            // document.querySelectorAll('input[type="date"]').forEach(input => {
            //     if (input.id.includes('end')) {
            //         input.value = today;
            //     }
            // });
        });
    </script>
</body>
</html>